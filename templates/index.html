<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestão André - Estratégico</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body { background-color: #0f0f0f; color: #e5e7eb; font-family: 'Inter', sans-serif; }
        .card-glass { background: #1a1a1a; border: 1px solid #2d2d2d; border-radius: 1rem; }
    </style>
</head>
<body class="p-4 max-w-4xl mx-auto">
    <header class="flex justify-between items-center mb-8">
        <div>
            <h1 class="text-xl font-black tracking-tight text-white">PERFORMANCE UNIFICADA</h1>
            <p class="text-gray-500 text-xs uppercase tracking-widest">Controle de Fluxo de Caixa</p>
        </div>
        <div class="text-right">
            <span id="timestamp" class="text-emerald-500 font-mono text-sm tracking-tighter">--:--:--</span>
        </div>
    </header>

    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
        <div class="card-glass p-5">
            <p class="text-[10px] text-gray-500 font-bold uppercase mb-2">Hoje</p>
            <div id="v_diario" class="text-2xl font-bold">R$ 0,00</div>
            <div class="text-[10px] text-blue-400 mt-1"><i class="fas fa-box-open"></i> <span id="q_diario">0</span> ITENS</div>
            <div id="l_diario" class="text-sm font-semibold text-emerald-500 mt-3">+ R$ 0,00 Lucro</div>
        </div>
        <div class="card-glass p-5">
            <p class="text-[10px] text-gray-500 font-bold uppercase mb-2">Mês Atual</p>
            <div id="v_mensal" class="text-2xl font-bold">R$ 0,00</div>
            <div class="text-[10px] text-blue-400 mt-1"><i class="fas fa-box-open"></i> <span id="q_mensal">0</span> ITENS</div>
            <div id="l_mensal" class="text-sm font-semibold text-emerald-500 mt-3">+ R$ 0,00 Lucro</div>
        </div>
        <div class="card-glass p-5 border-emerald-900/30">
            <p class="text-[10px] text-gray-500 font-bold uppercase mb-2">Ano 2026</p>
            <div id="v_anual" class="text-2xl font-bold text-white">R$ 0,00</div>
            <div class="text-[10px] text-blue-400 mt-1"><i class="fas fa-box-open"></i> <span id="q_anual">0</span> ITENS</div>
            <div id="l_anual" class="text-sm font-semibold text-emerald-500 mt-3">+ R$ 0,00 Lucro</div>
        </div>
    </div>

    <section class="card-glass p-6">
        <div class="flex items-center justify-between mb-6">
            <h2 class="text-sm font-bold text-gray-400 uppercase tracking-wider">Explorar Meses</h2>
            <select id="seletor_mes" class="bg-black border border-gray-700 text-xs rounded-lg px-3 py-2 outline-none focus:border-emerald-500 transition-all cursor-pointer">
                </select>
        </div>

        <div id="view_detalhe" class="grid grid-cols-2 gap-4">
            <div class="bg-black/40 p-4 rounded-lg">
                <p class="text-[10px] text-gray-500 uppercase">Vendas no Mês</p>
                <p id="det_vendas" class="text-lg font-bold">R$ 0,00</p>
                <p class="text-[10px] text-blue-400 font-mono" id="det_itens">0 ITENS</p>
            </div>
            <div class="bg-black/40 p-4 rounded-lg">
                <p class="text-[10px] text-gray-500 uppercase">Gastos no Mês</p>
                <p id="det_gastos" class="text-lg font-bold text-red-500">R$ 0,00</p>
            </div>
        </div>
    </section>

    <script>
        let dadosMensais = [];
        const fmt = (v) => v.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });

        async function fetchDash() {
            const r = await fetch('/api/status');
            const d = await r.json();
            
            // Atualiza Cards Principais
            document.getElementById('timestamp').innerText = d.atualizado_em;
            document.getElementById('v_diario').innerText = fmt(d.diario.vendas);
            document.getElementById('q_diario').innerText = d.diario.itens;
            document.getElementById('l_diario').innerText = `+ ${fmt(d.diario.lucro)} Lucro`;
            
            document.getElementById('v_mensal').innerText = fmt(d.mensal.vendas);
            document.getElementById('q_mensal').innerText = d.mensal.itens;
            document.getElementById('l_mensal').innerText = `+ ${fmt(d.mensal.lucro)} Lucro`;
            
            document.getElementById('v_anual').innerText = fmt(d.anual.vendas);
            document.getElementById('q_anual').innerText = d.anual.itens;
            document.getElementById('l_anual').innerText = `+ ${fmt(d.anual.lucro)} Lucro`;

            // Configura Seletor Mensal
            dadosMensais = d.filtros_mensais;
            const seletor = document.getElementById('seletor_mes');
            const mesAtualId = new Date().getMonth() + 1;

            if (seletor.options.length === 0) {
                seletor.innerHTML = dadosMensais.map(m => `<option value="${m.id}" ${m.id === mesAtualId ? 'selected' : ''}>${m.mes}</option>`).join('');
            }
            atualizarDetalhe(seletor.value);
        }

        function atualizarDetalhe(id) {
            const m = dadosMensais.find(x => x.id == id);
            if (m) {
                document.getElementById('det_vendas').innerText = fmt(m.vendas);
                document.getElementById('det_gastos').innerText = fmt(m.gastos);
                document.getElementById('det_itens').innerText = `${m.itens} ITENS`;
            }
        }

        document.getElementById('seletor_mes').addEventListener('change', (e) => atualizarDetalhe(e.target.value));
        
        fetchDash();
        setInterval(fetchDash, 30000);
    </script>
</body>
</html>
